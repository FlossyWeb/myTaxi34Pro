<!doctype html>
<html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="CONTENT-LANGUAGE" content="French">
    <title>MonTaxi 34 Pro by Taxi Global Services</title>
    <link rel="apple-touch-icon" href="visuels/idev.favicon.png"/>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, minimum-scale=1, maximum-scale=1"/>
    <!-- <meta name="viewport" content="width=device-width, height=device-height, user-scalable=yes, initial-scale=1"/> -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="apple-touch-startup-image" href="visuels/startup_image.png" />
    <!-- iPhone -->
    <link rel="apple-touch-startup-image" media="(device-width: 320px)" href="visuels/startup_image.png">
    <!-- iPhone (Retina) -->
    <link rel="apple-touch-startup-image"
          media="(device-width: 320px)
             and (-webkit-device-pixel-ratio: 2)"
          href="visuels/startup_image_xl.png">
    <!-- iPhone 5 -->
    <link rel="apple-touch-startup-image"
            media="(device-width: 320px) and (device-height: 568px)
            and (-webkit-device-pixel-ratio: 2)"
            href="visuels/startup_image_i5.png">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
	<link rel="stylesheet" href="css/themes/monTaxiPro.min.css" />
	<link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
    <link type="text/css" rel="stylesheet" href="css/dcvpad.css" />
    <link type="text/css" rel="stylesheet" href="css/jqm-datebox-1.4.5.min.css" />
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
	<script type="text/javascript">
        $( document ).on( "mobileinit", function() {
            // Make your jQuery Mobile framework configuration changes here!
            $.support.cors = true;
            $.mobile.allowCrossDomainPages = true;
            $.mobile.selectmenu.prototype.options.nativeMenu = false;
			//$.mobile.ajaxEnabled = false;
			$.mobile.loader.prototype.options.text = "Veuillez patienter pendant la recherche de taxi disponible. Merci de votre confiance !";
			$.mobile.loader.prototype.options.textVisible = "true";
			$.mobile.loader.prototype.options.theme = "a";
			$.mobile.loader.prototype.options.html = '<span class="ui-bar ui-overlay-a ui-corner-all"><center><img src="visuels/preload_world.gif"/><br><span style="color:#F00;">Veuillez patienter pendant la recherche de taxis disponibles</span><br>Merci de votre confiance !</center></span>';
        });
    </script>    
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="phonegap.js"></script>
    <script src="barcodescanner.js"></script>
    <script src="contactNumberPicker.js"></script>
    <script src="sms.js"></script>
    <script type="text/javascript" src="js/jquery.html5storage.min.js"></script>
    <script type="text/javascript" src="js/jsimple-star-rating.min.js"></script>
    <script type="text/javascript" src="js/jqm-datebox-1.4.5.min.js"></script>
    <script type="text/javascript" src="js/jqm-datebox-fr-formats.js"></script>
    <script src="https://maps.google.com/maps/api/js?key=AIzaSyCvL4a4-LKLUXJrTwpJ4_UnkmtZSGgrVWg&sensor=false&libraries=places" type="text/javascript"></script>
	<!-- <script type="text/javascript" src="js/jquery.geocomplete.min.js"></script> -->
	<script type="text/javascript" src="ui/min/jquery.ui.map.full.min.js"></script>
    <script type="text/javascript">	
    //<![CDATA[
    var map;
    var markers = [];
    var infoWindow;
    var locationSelect;
	var idcourse = '';
	var zip = '';
	var time;
	var endcourse; // Clears the timeout
	var regName1 = $.localStorage.getItem('regName1');
	var regCell1 = $.localStorage.getItem('regCell1');
	var regName2 = $.localStorage.getItem('regName2');
	var regCell2 = $.localStorage.getItem('regCell2');
	var regName3 = $.localStorage.getItem('regName3');
	var regCell3 = $.localStorage.getItem('regCell3');
	var registeredUser = $.localStorage.getItem('registeredUser');
	var company = $.localStorage.getItem('company');
	var nom = $.localStorage.getItem('nom');
	var tel = $.localStorage.getItem('tel');
	var email = $.localStorage.getItem('email');
	var operator = $.localStorage.getItem('operator');
	var dontReg = false;
	var mobileMap = { 'center': '43.609, 3.88', 'zoom': 12 };
	var isPlaceChanged = true; // Assuming geolocation will get zip unless address is tipped at last

	// Scanner
	var scanner;
	// Detect wether it is an App or WebApp
	var app;

	////////////////////////////////////////////////////////////
	
	// Checks App or Browser
	app = document.URL.indexOf( 'http://' ) === -1 && document.URL.indexOf( 'https://' ) === -1 && document.URL.indexOf("localhost") != 7;
	if ( app ) {
		// PhoneGap application
		// Attendre que PhoneGap soit prêt	    //
		document.addEventListener("deviceready", onDeviceReady, false);
	
		// PhoneGap est prêt
		function onDeviceReady() {
			document.addEventListener("backbutton", onBackKeyDown, false);
			document.addEventListener("resume", onResume, false);
			//document.addEventListener("menubutton", onMenuKeyDown, false);
			StatusBar.overlaysWebView(false);
			StatusBar.backgroundColorByHexString("#99808E");
			if($.localStorage.getItem('registeredUser') != 1)
			{
				$.mobile.pageContainer.pagecontainer("change", "#connect", { transition: "slide"} );
			}
			else {
				$.post("https://www.mytaxiserver.com/taxioffsrv/blacklist.php", { userid: operator}, function(data) {
					if (data.banned == 1)
					{
						$.mobile.pageContainer.pagecontainer("change", "#subscription", { transition: "slide"} );
						var displayThis = '<p style="color:red;"><b>Votre compte &agrave; &eacute;t&eacute; banni pour cause d&rsquo;utilisation abusive, d&eacute;sol&eacute;.<br>Vous pouvez nous contacter pour toute r&eacute;clamation: </b></p><center><a href="mailto:info@taximedia.fr" class="ui-btn ui-btn-icon-left ui-icon-mail ui-btn-inline">Courriel</a><a href="tel:0413598022" class="ui-btn ui-btn-icon-left ui-icon-phone ui-btn-inline">T&eacute;l&eacute;phone</a></center>';
						$("#subReturns").empty().append(displayThis);
					}
				}, "json");
			}
			if((navigator.network.connection.type == Connection.NONE) || !window.jQuery){
				$("body").empty().append('<img src="no_network.png" width="'+screen.width+'" height="'+screen.height+'" onClick="window.location.reload()" />');
			}
			setTimeout(function() { 
				locateMe();
			}, 1000);
			scanner = cordova.require("cordova/plugin/BarcodeScanner");
		}
		// GESTION DES BOUTONS MATERIEL
		// Bouton retour
		function onBackKeyDown() {
			//history.back();
			//changePage('#infos');
			navigator.notification.alert("Veuillez ne pas quitter monTaxi pendant la recheche de taxi disponibles", alertDismissed, 'MonTaxi', 'OK');
		}
		function onResume() {
			if((navigator.network.connection.type == Connection.NONE) || !window.jQuery){
				$("body").empty().append('<img src="no_network.png" width="'+screen.width+'" height="'+screen.height+'" onClick="window.location.reload()" />');
			}
		}
		// Bouton menu
		//function onMenuKeyDown() {}
	}
	else {
		app = false;
		$(window).on('beforeunload', function(e) {
			if(idcourse!='') {
				stopCall();
				return "SI VOUS AVIEZ UNE COMMANDE EN COURS ELLE EST ANNULEE ! (CELA NE S'APPLIQUE PAS AUX RESERVATIONS)";
			}
		});
	}
	var scanSuccess = function (result) {
		var textFormats = "QR_CODE DATA_MATRIX";
		var productFormats = "UPC_E UPC_A EAN_8 EAN_13";
		if (result.cancelled) { return; }
		if (textFormats.match(result.format)) {                
			var scanVal = result.text;
			if (scanVal.indexOf("http") === 0) {
				setTimeout(function() { 
					//window.plugins.childBrowser.showWebPage(result.text, { showLocationBar: true }); 
					window.open(result.text,'_blank','location=yes,enableViewportScale=yes,closebuttoncaption=Fermer');
				}, 500);
			} else {
				navigator.notification.alert(
						result.text,
						function (){},
						'Scan Value:',
						'Done'
					);
			}
		} else if (productFormats.match(result.format)) {
			var searchUrl = "https://www.google.fr/#q=" + result.text;
			setTimeout(function() { 
				//window.plugins.childBrowser.showWebPage(searchUrl, { showLocationBar: true });
				window.open(searchUrl,'_blank','location=yes,enableViewportScale=yes,closebuttoncaption=Fermer');
			}, 500);
		} else { navigator.notification.alert("Format du scan: " + result.format + 
				  " NON SUPPORTE. Valeur du scan: " + result.text);
		}
	}
	function goScan ()
	{
		if (app) {
			// If app is runing we scan from the device camera
			scanner.scan(
				scanSuccess, 
				function (error) {
					navigator.notification.alert("Scan Erreur: " + error);
				}
			);
		}
		else {
			$('#smsReturn').empty().append('Cette fonction n&rsquo;est disponible que sur l&rsquo;application mobile');
			$( "#popSms" ).popup( "open", { positionTo: "window" } );
			//navigator.notification.alert('WTF');
		}
	}

	function Share()
	{
		var successCallbackPick = function(result){
			setTimeout(function(){
				//navigator.notification.alert(result.name + " " + result.phoneNumber);
				var number = result.phoneNumber;
				var message = "Téléchargez l'app monTaxi 34 en suivant ce lien : http://www.taximedia.fr/stores.php?app=mytaxi&dep=34";
				var intent = ""; //leave empty for sending sms using default intent
				var smsSuccess = function () {
					//navigator.notification.alert('Message sent successfully');
					$('#smsReturn').empty().append('Message envoy&eacute; avec succ&egrave;s, Merci');
					$( "#popSms" ).popup( "open", { positionTo: "window" } );
				};
				var smsError = function (e) {
					//navigator.notification.alert('Message Failed:' + e); 
					$('#smsReturn').empty().append('Probl&egrave;me lors de l&rsquo;envoi du message: ' + e);
					$( "#popSms" ).popup( "open", { positionTo: "window" } );
				};
				sms.send(number, message, intent, smsSuccess, smsError);
			},500);
		};
		var failedCallbackPick = function(result){
			setTimeout(function(){
				//navigator.notification.alert(result);
			},500);
		}
		if (app) {
			// If app is runing we get contact from the device
			window.plugins.contactNumberPicker.pick(successCallbackPick,failedCallbackPick);
		}
		else {
			$('#smsReturn').empty().append('Cette fonction n&rsquo;est disponible que sur l&rsquo;application mobile');
			$( "#popSms" ).popup( "open", { positionTo: "window" } );
			//navigator.notification.alert('WTF');
		}
	}
	function getContact()
	{
		var successCallbackPick = function(result){
			setTimeout(function(){
				//navigator.notification.alert(result.name + " " + result.phoneNumber);
				var nameContact = result.name;
				var number = result.phoneNumber;
				var currentName = $('#Accurate').val();
				$('#Accurate').val(nameContact);
				$('#cellular').val(number);
				$("#next-box").hide("fast");
				$("#search-box").show("medium");
			},500);
		};
		var failedCallbackPick = function(result){
			setTimeout(function(){
				//navigator.notification.alert(result);
			},500);
		}
		if (app) {
			// If app is runing we get contact from the device
			window.plugins.contactNumberPicker.pick(successCallbackPick,failedCallbackPick);
		}
		else {
			//navigator.notification.alert(nom+' - '+mngid+' - '+tel);
			$.post("https://www.mytaxiserver.com/server/get_contacts.php", {dep: '34', tel: tel}, function(data) {
				$('#contReturn').empty().append(data);
				$( "#popCont" ).popup( "open", { positionTo: "window" } );
			});
		}
	}
	function dc() {
		$.localStorage.setItem('registeredUser', 0);
		$.mobile.pageContainer.pagecontainer("change", "#connect", { transition: "slide"} );
	}
	function login() {
		var id = $('#login').val();
		var pwd = $('#pwd').val();
		$.post("https://www.mytaxiserver.com/mytaxisrv/login_app.php", { id: id, pwd: pwd, kinda: 'pro'}, function(data) {
			$.localStorage.setItem('nom', data.nom);
			$.localStorage.setItem('company', data.nom); // here name = company name
			$.localStorage.setItem('email', data.email);
			$.localStorage.setItem('tel', data.tel);
			$.localStorage.setItem('operator', data.operator);
			// Refresh Script Vars
			nom = data.nom;
			company = data.nom;
			tel = data.tel;
			email = data.email;
			operator = data.operator;
			if (!data.pass)
			{
				display = '<p style="color:red;"><b>Les identifiant et mot de passe fournis ne sont pas corrects.</b></p>';
				$("#loginReturns").empty().append(display);
			}
			else
			{ // IDENTIFIED SO GETS IN...
				$('#Accurate').val(data.nom);
				$('#cellular').val(data.tel);
				$.localStorage.setItem('registeredUser', 1);
				$.mobile.pageContainer.pagecontainer("change", "#infos", { transition: "slide"} );
			}
		}, "json");
	}
	function subscribe() {
		nom = $('#subName').val();
		tel = $('#subTel').val();
		email = $('#subMail').val();
		$("#subReturns").empty();
		$.post("https://www.mytaxiserver.com/mytaxisrv/register_app.php", { nom: nom, tel: tel, email: email, kinda: 'pro'}, function(data) {
			$.localStorage.setItem('nom', data.nom);
			$.localStorage.setItem('company', data.nom); // here name = company name
			$.localStorage.setItem('email', data.email);
			$.localStorage.setItem('tel', data.tel);
			$.localStorage.setItem('operator', data.operator);
			// Refresh Script Vars
			nom = data.nom;
			company = data.nom;
			tel = data.tel;
			email = data.email;
			operator = data.operator;
			if (data.subscribed === true)
			{
				//navigator.notification.alert(data.subscribed+' '+data.telexist+' '+data.telvalid+' '+data.emailvalid);
				$.localStorage.setItem('registeredUser', 1);
				$.mobile.pageContainer.pagecontainer("change", "#infos", { transition: "slide"} );
				//display = '<p><b>' + data.civil + ' ' + data.nom + ' ' + data.prenom + ' Voici les informations d&rsquo;identification qui vous permettront d&rsquo;acc&egrave;der &agrave; votre compte :<br><span style="color:#09F;">Identifiant = ' + data.tel + '<br>Mot de passe = ' + data.pwd + '</span><br>Vous les recevrez dans quelques instants &agrave; cet email : <span style="color:#09F;">' + data.email + '</span>, merci.<br></b></p>';
			}
			else {
				display = '<p><b>Vous n&rsquo;avez pas correctement rempli le formulaire d&rsquo;inscription. Nous vous prions de modifier les informations suivantes.</b></p><br>';
				
				if (data.telexist === true)
				{
					display += '<p style="color:red;"><b>Le num&eacute;ro de t&eacute;l&eacute;phone fourni est d&eacute;j&agrave; associ&eacute; &agrave; un compte.</b></p>';
				}
				if (data.telvalid === false)
				{
					display += '<p style="color:red;"><b>Le num&eacute;ro de t&eacute;l&eacute;phone fourni n&rsquo;est pas valide: 0000000000 (sans espaces).</b></p>';
				}
				if (data.emailvalid === false)
				{
					display += '<p style="color:red;"><b>L&rsquo;email fourni n&rsquo;est pas valide.</b></p>';
				}
			}
			$("#subReturns").empty().append(display);
		}, "json");
	}
	function accountMod() {
		tel = $.localStorage.getItem('tel');
		nom = $('#accName').val();
		newtel = $('#accTel').val();
		email = $('#accMail').val();
		pwd = $('#accPwd').val();
		$("#accReturns").empty();
		$.post("https://www.mytaxiserver.com/mytaxisrv/modmy_app.php", { nom: nom, tel: tel, newtel: newtel, email: email, pwd: pwd, kinda: 'pro'}, function(data) {
			$.localStorage.setItem('nom', data.nom);
			$.localStorage.setItem('company', data.nom); // here name = company name
			$.localStorage.setItem('email', data.email);
			$.localStorage.setItem('tel', data.tel);
			// Refresh Script Vars
			nom = data.nom;
			company = data.nom;
			tel = data.tel;
			email = data.email;
			if (data.modmy == 1)
			{
				display = '<p style="color:green;"><b>Vous avez bien modifi&eacute; votre compte.</b></p><br>';
			}
			else {
				display = '<p style="color:red;"><b>Vous n&rsquo;avez pas modifi&eacute; votre compte.</b></p><br>';
				
				if (data.telvalid === false)
				{
					display += '<p style="color:red;"><b>Le num&eacute;ro de t&eacute;l&eacute;phone fourni n&rsquo;est pas valide: 0000000000 (sans espaces).</b></p>';
				}
				if (data.emailvalid === false)
				{
					display += '<p style="color:red;"><b>L&rsquo;email fourni n&rsquo;est pas valide.</b></p>';
				}
				if ((data.telvalid == 1) && (data.emailvalid == 1))
				{
					display += '<p style="color:red;"><b>Le t&eacute;l&eacute;phone renseign&eacute; n&rsquo;est associ&eacute; &agrave; aucun compte.</b></p>';
				}
			}
			$("#accReturns").empty().append(display);
		}, "json");
	}
	function forgottenPwd() {
		var login = $('#forgotTel').val();
		var mail = $('#forgotMail').val();
		$.post("https://www.mytaxiserver.com/mytaxisrv/forget_app.php", { login: login, mail: mail, kinda: 'pro'}, function(data) {
			var display = '';
			if (data.sent)
			{
				display = '<p><b>Voici les informations d&rsquo;identification qui vous permettront d&rsquo;acc&egrave;der &agrave; votre compte :<br><span style="color:#09F;">Identifiant = ' + data.tel + '<br>Mot de passe = ' + data.pwd + '</span><br>Vous les recevrez dans quelques instants &agrave; cet email : <span style="color:#09F;">' + data.email + '</span>, merci.<br></b></p>';
			}
			else {
				display = '<p style="color:red;"><b>Nous ne pouvons divulguer vos informations personnelles car l&rsquo;identifiant ou l&rsquo;adresse mail fourni ne figure pas dans notre base de donn&eacute;e.</b></p>' + data.tel + ' - ' + data.email;
			}
			$("#fogotReturns").empty().append(display);
		}, "json");
	}
	function alertDismissed()
	{
		// Do Nothing...
	}
	$(document).on( 'pagecreate', function() {
		$( "body>[data-role='panel']" ).panel().enhanceWithin();
	});
	$( '#connect' ).live( 'pagecreate',function(event){
		$('#displayForgot').click(function (){
			$('#forgotForm').slideToggle();
		});
	});
	$( '#account' ).live( 'pagecreate',function(event){
		nom = $.localStorage.getItem('nom');
		tel = $.localStorage.getItem('tel');
		email = $.localStorage.getItem('email');
		$('#accName').val(nom);
		$('#accMail').val(email);
		$('#accTel').val(tel);
	});
	function more(n) {
		$('#histBlock'+n).slideToggle('slow', function() {
			// Animation complete.
			if($('#histBlock'+n).css("display")=='none') {
				$('#hbtn'+n).removeClass('ui-icon-minus').addClass('ui-icon-plus');
			}
			else {
				$('#hbtn'+n).removeClass('ui-icon-plus').addClass('ui-icon-minus');
			}
		});
	}
	function moreb(n) {
		$('#bookBlock'+n).slideToggle('slow', function() {
			if($('#bookBlock'+n).css("display")=='none') {
				$('#bbtn'+n).removeClass('ui-icon-minus').addClass('ui-icon-plus');
			}
			else {
				$('#bbtn'+n).removeClass('ui-icon-plus').addClass('ui-icon-minus');
			}
		});
	}
	function refreshHist() {
		$.mobile.loading( "show" );
		$.post("https://www.mytaxiserver.com/mytaxisrv/history_v2.php", { tel: tel, pass: 1, dep: '34', operator: operator, hist: 1}, function(data){
			$("#hist_cont").empty().append(data);
		}).done(function() { 
			$.post("https://www.mytaxiserver.com/mytaxisrv/history_v2.php", { tel: tel, pass: 1, dep: '34', operator: operator, hist: 0}, function(data){
				$("#book_cont").empty().append(data);
			}).done(function() { $.mobile.loading( "hide" ); });
		});
	}
	function showCont(cont2show, cont2hide) {
		if($(window).width()<=1006) {
			// Only hides cont if conts are not both displayed, see css breakpoint
			$(cont2hide).hide();
			$(cont2show).show();
		}
	}
	$( '#history' ).live( 'pagecreate',function(event){
		$.mobile.loading( "show" );
		$.post("https://www.mytaxiserver.com/mytaxisrv/history_v2.php", { tel: tel, pass: 1, dep: '34', operator: operator, hist: 1}, function(data){
			$("#hist_cont").empty().append(data);
		}).done(function() { 
			$.post("https://www.mytaxiserver.com/mytaxisrv/history_v2.php", { tel: tel, pass: 1, dep: '34', operator: operator, hist: 0}, function(data){
				$("#book_cont").empty().append(data);
			}).done(function() { $.mobile.loading( "hide" ); });
		});
	});
	function rateCab(rtaxi, ridcourse, rdep, rtel)
	{
		$.sessionStorage.setItem('rtaxi', rtaxi);
		$.sessionStorage.setItem('ridcourse', ridcourse);
		$.sessionStorage.setItem('rdep', rdep);
		$.sessionStorage.setItem('rtel', rtel);
		$.mobile.pageContainer.pagecontainer("change", "#rate_page", { transition: "slide"} );
	}
	$( '#rate_page' ).live( 'pagecreate',function(event){
		var noted = $.sessionStorage.getItem('rtaxi');
		$('#urate').empty().append('Vous notez le taxi '+noted);
		$(".rating").starRating({
			minus: false // step minus button
		});
		$(".rating2").starRating({
			minus: false // step minus button
		});
		$(".rating3").starRating({
			minus: false // step minus button
		});
		$(".rating4").starRating({
			minus: false // step minus button
		});
	});
	function rating()
	{
		var rtaxi = $.sessionStorage.getItem('rtaxi');
		var ridcourse = $.sessionStorage.getItem('ridcourse');
		var rdep = $.sessionStorage.getItem('rdep');
		var rtel = $.sessionStorage.getItem('rtel');
		var accueil = $(".rating").data("val");
		var tarif = $(".rating2").data("val");
		var vehicule = $(".rating3").data("val");
		var conduite = $(".rating4").data("val");
		//navigator.notification.alert(rtaxi+' - '+ridcourse+' - '+rdep+' - '+rtel+' - '+accueil+' - '+tarif+' - '+vehicule+' - '+conduite);
		$.post("https://www.mytaxiserver.com/mytaxisrv/rate.php", { taxi: rtaxi, idcourse: ridcourse, dep: rdep, tel: rtel, accueil: accueil, tarif: tarif, vehicule: vehicule, conduite: conduite, judge: 1}, function(data){ $('#rateBack').empty().append('Vos notes ont &eacute;t&eacute; prise en compte, Merci.');});
	}
	function booking()
	{
		dep = $.sessionStorage.getItem('dep');
		//navigator.notification.alert(dep);
		if (isPlaceChanged || (dep != '') || (zip != '')) {
			$('#booking').prop('disabled', true).addClass('ui-disabled'); // If ok disable btn to prevent multiple tap
			var myDate = new Date();
			idcourse = myDate.getTime();
			//$('#dblinks').append($('<input id="idcourse" type="hidden" value="' + idcourse + '"/>'));
			//var radius = document.getElementById('radiusSelect').value;
			company = $.localStorage.getItem('company');
			var rdvpoint = document.getElementById("addressInput").value.replace(/'/g, "&rsquo;");
			var room = document.getElementById("Accurate").value.replace(/'/g, "&rsquo;");
			operator = $.localStorage.getItem('operator');
			var hostname = document.getElementById("hostname").value.replace(/'/g, "&rsquo;");
			var howMany = document.getElementById("howMany").value;
			var typecar = document.getElementById("CarType").value;
			var cb = document.getElementById("Pay").value;
			var group = document.getElementById("group").value;
			switch (cb) {
				case '0':
					var payment = "Non";
					cb = 0;
				  break;
				case '1':
					var payment = "Oui";
					cb = 1;
				  break;
				case '2':
					var payment = "Oui (AMEX)";
					cb = 1;
				  break;
				default:
					var payment = "Non";
					cb = 0;
			}
			var coms = document.getElementById("coms").value.replace(/'/g, "&rsquo;");
			var comments1 = '<ul>' + company + '<li>Nom du client : ' + room + '</li><li>Paiement CB : ' + payment + '</li><li>Nombre de passagers : ' + howMany + '</li><li>Type de vehicule : ' + typecar + '</li>';
			if (coms != '') {
				var comments2 = '<li>' + coms + '</li></ul>';
			}
			else {
				var comments2 = '</ul>';
			}
			var comments = comments1+comments2;
			var dest = document.getElementById("DestAddress").value.replace(/'/g, "&rsquo;");
			var cell = document.getElementById("cellular").value;
			var when = document.getElementById("when").value;
			var date = document.getElementById("date").value;
			//var medic = document.getElementById("medic").value;
			if (!dontReg) {
				for(n=1;n<4;n++) {
					if(($.localStorage.getItem('regName'+n) == null) && ($.localStorage.getItem('regCell'+n) == null)) {
						var regName = $.localStorage.setItem('regName'+n, $('#Accurate').val());
						var regCell = $.localStorage.setItem('regCell'+n, cell);
						var regLast = $.localStorage.setItem('regLast', n);
						var writen = true;
						break;
					}
				}
				if(!writen) {
					var regLast = $.localStorage.getItem('regLast');
					switch (regLast) {
						case '1':
							var entry = 2;
						  break;
						case '2':
							var entry = 3;
						  break;
						case '3':
							var entry = 1;
						  break;
						default:
					}
					var regName = $.localStorage.setItem('regName'+entry, $('#Accurate').val());
					var regCell = $.localStorage.setItem('regCell'+entry, cell);
				}
			}
			var rdvlat = '';
			var rdvlng = '';
			url = '';
			num_req = idcourse;
			url = 'taxi=0000&tel=0000000000&idcourse=' + idcourse + '&num_req=' + num_req + '&rdvpoint=' + rdvpoint + '&lat=' + rdvlat + '&lng=' + rdvlng + '&comments=' + comments + '&cell=' + cell + '&when=' + when + '&date=' + date + '&operator=' + operator + '&howmany=' + howMany + '&zip=' + zip + '&dep=34&group=1&ack=0&db=1&prix=20000';
			url = url.replace(/'/g, "&rsquo;");
			url = url.replace(/(?:\r\n|\r|\n)/g, '<br/>'); // Replaces line breaks by <br/>
			$.post("https://www.mytaxiserver.com/server/bookings_app_share.php", url, function(data) {
				if(!data.ok) {
					//alert('Vous ne pouvez reserver un taxi que si le RDV est dans plus de 60 minutes !!');
					//Sending as direct job
					if(data.past) {
						alert('LA DATE DU RDV EST PASSEE !!');
					}
					else {
						checkZip('#map_page');
					}
				}
				else {
					$.mobile.pageContainer.pagecontainer("change", "#book_page", { transition: "slide"} );
				}
				$('#booking').prop('disabled', false).removeClass('ui-disabled');
			}, "json");
		}
		else {
			//navigator.notification.alert('No Zip Code Here !!');
			$( "#setZip" ).popup( "open", { positionTo: "window" } );
		}
	}
	$( '#book_page' ).live( 'pagecreate',function(event){
	});
	function modCmd(recidcourse, recrdv, reccomments, reccell, recwhen, recdep)
	{		
		$('#addressInput2').val(recrdv);
		$('#Accurate2').val(nom);
		$('#cellular2').val(reccell);
		//$('#coms2').text(reccomments);
		$('#date2').val(recwhen);
		$('#modId').val(recidcourse);
		$('#modDep').val(recdep);
		$.mobile.pageContainer.pagecontainer("change", "#modbook", { transition: "slide"} );
	}
	$( '#modbook' ).live( 'pagecreate',function(event){
		$('.expends2').click(function () {
			$(this).next('div').slideToggle('slow');
			//$.mobile.silentScroll($(this).next('div').offset().top);
		});
	});
	function bookingMod()
	{		
		var newAdd = $('#addressInput2').val();
		var newName = $('#Accurate2').val();
		var newCell = $('#cellular2').val();
		var newHowMany = $('#howMany2').val();
		var newType = $('#CarType2').val();
		var newCb = $('#Pay2').val();
		var newWhen = $('#date2').val();
		var newId = $('#modId').val();
		var newDep = $('#modDep').val();
		var payment = "Non";
		if(newCb == 1) {
			payment = "Oui";
		}
		var newComs = document.getElementById("coms2").value.replace(/'/g, "&rsquo;");
		var comments1 = '<ul><li>Nom du client : ' + newName + '</li><li>Paiement CB : ' + payment + '</li><li>Nombre de passagers : ' + newHowMany + '</li><li>Type de vehicule : ' + newType + '</li>';
		if (newComs != '') {
			var comments2 = '<li>' + newComs + '</li></ul>';
		}
		else {
			var comments2 = '</ul>';
		}
		var comments = comments1+comments2;
		url = 'taxi=0000&tel=0000000000&idcourse=' + newId + '&rdvpoint=' + newAdd + '&comments=' + comments + '&cell=' + newCell + '&when=' + newWhen+ '&howmany=' + newHowMany + '&dep=' + newDep+'&db=1';
		//navigator.notification.alert(url);
		url = url.replace(/'/g, "&rsquo;");
		url = url.replace(/(?:\r\n|\r|\n)/g, '<br/>'); // Replaces line breaks by <br/>
		$.post("https://www.mytaxiserver.com/server/bookings_app_mod.php", url, function(data) {
			//$('#resmod').append(data.req);
			if(!data.ok) {
				if(app) navigator.notification.alert('Vous ne pouvez modifier la reservation !!');
				else alert('Vous ne pouvez modifier la reservation !!');
			}
			else {
				$.mobile.pageContainer.pagecontainer("change", "#book_page", { transition: "slide"} );
			}
		}, "json");
	}
	/*
	$('#infos').live("swiperight", function() {
		$("#panel_poper").trigger('click');
	});
	*/
	$( '#infos' ).live( 'pagecreate',function(event){
		
		/*
		$("#addressInput").geocomplete({
		  map: "#map",
		  location: "Montpellier, France"
		});
		*/
		var input = document.getElementById('addressInput');
		var options = {
		  componentRestrictions: {country: 'fr'}
		};
		var autocomplete = new google.maps.places.Autocomplete(input, options);
		google.maps.event.addListener(autocomplete, 'place_changed', function() {
			//navigator.notification.alert('Fired');
			isPlaceChanged = true;
			var place = autocomplete.getPlace();
			var address = '';
			var zip_code = '';
			if (place.address_components) {
				address = [
					(place.address_components[0] && place.address_components[0].short_name || ''),
					(place.address_components[1] && place.address_components[1].short_name || ''),
					(place.address_components[2] && place.address_components[2].short_name || '')
				].join(' ');
				for (var i=0; i<place.address_components.length;i++)
				{
					for (var j=0;j<place.address_components[i].types.length;j++)
					{
						if (place.address_components[i].types[j] == "postal_code")
						{
							zip_code = place.address_components[i].long_name;
							zip = zip_code;
						}
					}
				}
			}
		});
        $("#addressInput").keydown(function () {
			// Place is tiped into field and not chosen from the api responses
            isPlaceChanged = false;
        });
		
		if(!app) {
			if($.localStorage.getItem('registeredUser') != 1)
			{
				$.mobile.pageContainer.pagecontainer("change", "#connect", { transition: "slide"} );
			}
			else {
				$.post("https://www.mytaxiserver.com/taxioffsrv/blacklist.php", { userid: operator}, function(data) {
					if (data.banned == 1)
					{
						$.mobile.pageContainer.pagecontainer("change", "#subscription", { transition: "slide"} );
						var displayThis = '<p style="color:red;"><b>Votre compte &agrave; &eacute;t&eacute; banni pour cause d&rsquo;utilisation abusive, d&eacute;sol&eacute;.<br>Vous pouvez nous contacter pour toute r&eacute;clamation: </b></p><center><a href="mailto:info@taximedia.fr" class="ui-btn ui-btn-icon-left ui-icon-mail ui-btn-inline">Courriel</a><a href="tel:0413598022" class="ui-btn ui-btn-icon-left ui-icon-phone ui-btn-inline">T&eacute;l&eacute;phone</a></center>';
						$("#subReturns").empty().append(displayThis);
					}
				}, "json");
			}
			locateMe();
			$('.noAppHide').each(function () {
				$(this).hide();
			})
			$('#date').prop('type', 'text');
			$('#when').prop('type', 'text');
			$('#date').datebox({
				mode: "calbox",
				afterToday: true,
				useFocus: true
			});
			$('#when').datebox({
				mode: "timebox",
				overrideTimeOutput: "%k:%M",
				useFocus: true
			});
		}
		once = true;
        var ok = setInterval( function () {
            var name_filled = document.getElementById("Accurate").value;
            var cell_filled = document.getElementById("cellular").value;
			var when = document.getElementById("when").value;
			var date = document.getElementById("date").value;
			var howMany = document.getElementById("howMany").value;
            
            if ((cell_filled != '') && (name_filled != ''))
            {
				if ((when != '') && (date != '')) {
					// Cmd here
					$("#next-box").hide("fast");
					$("#search-box").hide("fast");
					$("#book-box").show("medium");
				}
				else { // No Cmd
					$("#next-box").hide("fast");
					$("#book-box").hide("fast");
					$("#search-box").show("medium");
				}
            }
            else
            {
                $("#search-box").hide("fast");
				$("#book-box").hide("fast");
                $("#next-box").show("medium");
            }
			if(howMany>8) {
				if(once) {
					if(app) navigator.notification.alert('Pour plus de huit personnes veuillez passer une reservation SVP');
					else alert('Pour plus de huit personnes veuillez passer une reservation SVP');
					$('#book').slideToggle('slow');
					$('#date').focus();
				}
				once = false;
			}
        }, 1000);
		nom = $.localStorage.getItem('nom');
		tel = $.localStorage.getItem('tel');
		$('#Accurate').val(nom);
		$('#cellular').val(tel);
		$('.expends').click(function () {
			$(this).next('div').slideToggle('slow');
			//$.mobile.silentScroll($(this).next('div').offset().top);
		});
		
		$('#regLinks').append('<fieldset data-role="controlgroup"><legend>Derni&egrave;res informations saisies:</legend>');
		for(n=1;n<4;n++) {
			if(($.localStorage.getItem('regName'+n) != null) && ($.localStorage.getItem('regCell'+n) != null)) {
				rName = $.localStorage.getItem('regName'+n);
				rCell = $.localStorage.getItem('regCell'+n);
				$('#regLinks').append('<button id="reg'+n+'" onClick="Fillin(\''+rName+'\',\''+rCell+'\')" class="ui-shadow ui-btn ui-btn-b ui-corner-all ui-icon-star">'+rName+' - '+rCell+'</button>');
			}
		}
		$('#regLinks').append('</fieldset>');
	});
	function locateMe() {
		if (navigator.userAgent.toLowerCase().match(/android/)) {
			navigator.geolocation.getCurrentPosition(codeLatLng, showError,{enableHighAccuracy:false, maximumAge:0});
		}
		else {
			navigator.geolocation.getCurrentPosition(codeLatLng, showError,{enableHighAccuracy:true, maximumAge:0});
		}
	}
	function codeLatLng(position) {
		var geocoder = new google.maps.Geocoder();
		var lat = position.coords.latitude;
		var lng = position.coords.longitude;
		var latlng = new google.maps.LatLng(lat, lng);
		geocoder.geocode({'latLng': latlng}, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK)
			{
				if (results[0]) {
					$('#addressInput').val(results[0].formatted_address);
					$('#addressInput2').val(results[0].formatted_address);
					for(var i=0; i < results[0].address_components.length; i++)
					{
						var component = results[0].address_components[i];
						if(component.types[0] == "postal_code")
						{
							zip = component.long_name;
						}
					}
				}
				else {
						navigator.notification.alert('No results found');
				}
			}
			else {
				navigator.notification.alert('Geocoder failed due to: ' + status);
			}
		});
	}
	function showError(error)
	{
		var x=document.getElementById("resultsGeo");
		switch(error.code) 
		{
			case error.PERMISSION_DENIED:
			  x.innerHTML="<strong>Vous avez refus&eacute; l&rsquo;acc&egrave;s &agrave; la G&eacute;olocalisation.</strong>"
			  break;
			case error.POSITION_UNAVAILABLE:
			  x.innerHTML="<strong>G&eacute;olocalisation indisponible, veuillez regarder dans l&rsquo;aide ou activer le service dans les reglages de votre appareil.</strong>"
			  break;
			case error.TIMEOUT:
			  x.innerHTML="<strong>La demande de G&eacute;olocalisation a expir&eacute;(user location request timed out).</strong>"
			  break;
			case error.UNKNOWN_ERROR:
			  x.innerHTML="<strong>Erreur inconnue de G&eacute;olocalisation (unknown error occurred).</strong>"
			  break;
			default:
			  x.innerHTML="<strong>Erreur de G&eacute;olocalisation, red&eacute;marrage du smartphone n&eacute;c&eacute;ssaire.</strong>"
		}
		// Fall back to no options and try again for Android to work.
		navigator.geolocation.getCurrentPosition(codeLatLng, function(){
			$( "#errorPop" ).popup( "open", { positionTo: "window" } );
		});
	}			  
	function Fillin(Name, Cell)
	{
		$('#Accurate').val(Name);
		$('#cellular').val(Cell);
		$("#next-box").hide("fast");
		$("#rememberMe").popup("close");
		$("#search-box").show("medium");
		dontReg = true;
	}
	function checkZip(pageToGo) {
		$('#search').prop('disabled', true).addClass('ui-disabled'); // Prevents from multitap
		if (isPlaceChanged || (zip != '')) {
			$.mobile.pageContainer.pagecontainer("change", pageToGo, { transition: "slide", reverse: true} );
			$('#search').prop('disabled', false).removeClass('ui-disabled'); // Button is back
		}
		else {
			$( "#setZip" ).popup( "open", { positionTo: "window" } );
			$('#search').prop('disabled', false).removeClass('ui-disabled'); // Prevents from multitap
		}
	}
	function setZip() {
		zip = $('#zipDep').val();
		var dep = zip.substring(0, 2);
		$.sessionStorage.setItem('dep', dep);
		$.mobile.pageContainer.pagecontainer("change", "#infos", { transition: "slide", reverse: true} );
	}
	$( '#map_page' ).live( 'pagebeforeshow',function(event){
		//$('#map').gmap('clear', 'markers');
		//$('#dblinks').empty();	 
	});
	$('#map_page').live('pagecreate', function() {
        endcourse = setTimeout( function () {
            $("#cancel").trigger('click');
        }, 180000);
		//demo.add('basic_map', function() {
		//$('#dblinks').empty();
		$('#map').gmap({'center': mobileMap.center, 'zoom': mobileMap.zoom, 'disableDefaultUI':false, 'mapTypeId': google.maps.MapTypeId.ROADMAP, 'callback': function() {
		//$('#map').gmap({'callback': function() {
			var self = this;
			var geocoder = new google.maps.Geocoder();
			var  address = $('#addressInput').val();
			//var address = document.getElementById("addressInput").value;
			geocoder.geocode({address: address}, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
					//$('#dblinks').append($('<p>' + results[0].geometry.location + '__RDV</p>'));
					var myPlace = results[0].geometry.location;
					$.mobile.loading( "show" );
					//self.refresh();
					wait4Me = setTimeout( function () {
						searchLocationsNear(myPlace, self);
						//$.mobile.loading( "hide" );
					}, 2000);
					
					var userIcon = 'visuels/business_loc_icon.png';
					self.get('map').panTo(myPlace);
					//self.get('map').setZoom(12);
					//self.get('map').setCenter(myPlace);
					self.addMarker({'position': myPlace, 'bounds': true, 'icon': userIcon }).click(function() {
						self.openInfoWindow({ 'content': '<p style="color:#333;">'+address+' / Lieu de prise en charge</p>' }, this);
					});
					//var gcenter = myPlace.lat().toFixed(4) +", "+ myPlace.lng().toFixed(4);
					//var circleCenter = new google.maps.LatLng(gcenter);
					self.addShape('Circle', {
						'strokeWeight': 0, 
						'fillColor': "#008595", 
						'fillOpacity': 0.25, 
						'center': myPlace, 
						'radius': 2000, 
						'clickable': false 
					});
					
					//searchLocationsNear(myPlace, self);
				} else {
					if(app) navigator.notification.alert(address + ' NON TROUVEE ');
					else alert(address + ' NON TROUVEE ');
					$.mobile.pageContainer.pagecontainer("change", "#infos", { transition: "slide", reverse: true} );
				}
			});
		}}); 
		
        // Auto Click and deliver courses to cabs
        $('#deliver').click(function () {
                                 
            check_answer();
                        
			var index = 0;
			$('#dblinks #' + index).trigger('click');// Deliver to the first before timer !!
			index++; // Now index = 1
			time = setInterval( function () {
				var stoper = document.getElementById('stop').value;
				if (stoper != 1) {$('#dblinks #' + index).trigger('click');}
				if ((index > 5) || (stoper == 1)) {
					// THIS ONE IS THE 0000 CAB AND LAST ONE SO...
					clearInterval(time); // Clears the current Interval
                    //clearTimeout(endcourse);
					//navigator.notification.alert('Aucun taxi ne prend la course !!');
					//return false;
				}
				index++;
			}, 10000);            
        });
	});
	
	$('#map_page').live('pageshow', function() {
		//demo.add('basic_map', function() { $('#map').gmap('refresh'); }).load('basic_map');
		//$('#map').gmap("option", "center", mobileMap.center);
		$('#map').gmap('refresh');
	});
	////////////////////////////////////////////////////////////
		
	$('#fleet_page').live('pagecreate', function() {
		$('#fleet_map').gmap({'center': mobileMap.center, 'zoom': mobileMap.zoom, 'disableDefaultUI':true, 'mapTypeId': google.maps.MapTypeId.ROADMAP, 'callback': function() {
			var self = this;
			$.post('https://www.mytaxiserver.com/appserver/station_fleet_xml.php?group=1&dep=34', function(xml){
				$(xml).find('marker').each(function(){
					var name = $(this).attr('name');
					var address = $(this).attr('address');
					var lat = $(this).attr('lat');
					var lng = $(this).attr('lng');
					var timestamp = $(this).attr('timestamp');
					i = $(this).attr('count');
					var latlng = new google.maps.LatLng(lat, lng);			
					var display_name = 'Taxi ' + name;
					var cabIcon = 'visuels/taxi_loc_icon.png';
					self.addMarker({ id: i ,'position': latlng, 'bounds': true, 'title': display_name, 'icon': cabIcon }).click(function() {
						infoCont = '<p style="color:#333;"><b>taxi n&deg; ' + name + ' - ' + address+ '</b></p>';
						self.openInfoWindow({ 'content':  infoCont}, this);
					});
				});
				$('.cabNum').empty().append('Il y a actuellement '+i+' Taxis disponibles.');
			});
		}});
	});
	
	$('#fleet_page').live('pageshow', function() {
		$('#fleet_map').gmap('refresh');
	});
	////////////////////////////////////////////////////////////
	
	function followCab(ftaxi, fidcourse, fdep, ftel, frdv, ftable)
	{
		$.sessionStorage.setItem('ftaxi', ftaxi);
		$.sessionStorage.setItem('fidcourse', fidcourse);
		$.sessionStorage.setItem('fdep', fdep);
		$.sessionStorage.setItem('ftel', ftel);
		$.sessionStorage.setItem('frdv', frdv);
		$.sessionStorage.setItem('ftable', ftable);
		$.mobile.pageContainer.pagecontainer("change", "#follow", { transition: "slide"} );
	}
	$('#follow').live('pagecreate', function() {
		var ftaxi = $.sessionStorage.getItem('ftaxi');
		var fidcourse = $.sessionStorage.getItem('fidcourse');
		var fdep = $.sessionStorage.getItem('fdep');
		var ftel = $.sessionStorage.getItem('ftel');
		var frdv = $.sessionStorage.getItem('frdv');
		var ftable = $.sessionStorage.getItem('ftable');
		$('#follow_map').gmap({'center': mobileMap.center, 'zoom': mobileMap.zoom, 'disableDefaultUI':true, 'mapTypeId': google.maps.MapTypeId.ROADMAP, 'callback': function() {
			var self = this;
			navigator.geolocation.getCurrentPosition(function(position, status) {
				var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude)
				self.get('map').panTo(latlng);
				var userIcon = 'visuels/business_loc_icon.png';
				self.addMarker({ id: 'you', 'position': latlng, 'bounds': true, 'icon': userIcon }).click(function() {
					self.openInfoWindow({ 'content':  '<p style="color:#09F;"><b>Vous &Ecirc;tes ici</b></p>' }, this);
				});
			}, showError,{enableHighAccuracy:true, maximumAge:0});
			var geocoder = new google.maps.Geocoder();
			var address = frdv;
			geocoder.geocode({address: address}, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
					var rdvPlace = results[0].geometry.location;
					//self.refresh();
					var rdvIcon = 'visuels/rdv_marker.png';
					self.get('map').panTo(rdvPlace);
					//self.get('map').setZoom(12);
					//self.get('map').setCenter(rdvPlace);
					self.addMarker({'position': rdvPlace, 'bounds': true, 'icon': rdvIcon }).click(function() {
						self.openInfoWindow({ 'content': '<p style="color:#6C0;"><b>Lieu de prise en charge</b></p>' }, this);
					});
					//var gcenter = rdvPlace.lat().toFixed(4) +", "+ rdvPlace.lng().toFixed(4);
					//var circleCenter = new google.maps.LatLng(gcenter);
					self.addShape('Circle', {
						'strokeWeight': 0, 
						'fillColor': "#008595", 
						'fillOpacity': 0.25, 
						'center': rdvPlace, 
						'radius': 500, 
						'clickable': true 
					});
				} else {
					if(app) navigator.notification.alert('ADRESSE RDV : '+address+' NON TROUVEE ');
					else alert('ADRESSE RDV : '+address+' NON TROUVEE ');
				}
			});
			$.post('https://www.mytaxiserver.com/appserver/follow.php', { taxi: ftaxi, idcourse: fidcourse, dep: fdep, tel: ftel, table: ftable }, function(data){
				if(data.ok) {
					var latlng = new google.maps.LatLng(data.lat, data.lng);
					var display_name = 'Taxi ' + data.name;
					var cabIcon = 'visuels/taxi_loc_icon.png';
					self.addMarker({ id: 'cab', 'position': latlng, 'bounds': true, 'title': display_name, 'icon': cabIcon }).click(function() {
						infoCont = '<p style="color:#333;"><b>taxi n&deg; ' + data.name + ' - ' + data.address+ ' &agrave; ' + data.timestamp+ '</b></p>';
						self.openInfoWindow({ 'content':  infoCont}, this);
					});
				}
				else {
					if(app) navigator.notification.alert('Vous ne pouvez suivre un taxi que 30 minutes avant le RDV !!');
					else alert('Vous ne pouvez suivre un taxi que 30 minutes avant le RDV !!');
					//document.location.href='index.html';
					$.mobile.pageContainer.pagecontainer("change", "#history", { transition: "slide"} );
				}
			}, "json");
			var track = setInterval( function () {
				$.post('https://www.mytaxiserver.com/appserver/follow.php', { taxi: ftaxi, idcourse: fidcourse, dep: fdep, tel: ftel, table: ftable }, function(data){
					var markerCab = self.get('markers')['cab'];
					markerCab.setVisible(false);
					var latlng = new google.maps.LatLng(data.lat, data.lng);
					var display_name = 'Taxi ' + data.name;
					var cabIcon = 'visuels/taxi_loc_icon.png';
					self.addMarker({ id: 'cab', 'position': latlng, 'bounds': true, 'title': display_name, 'icon': cabIcon }).click(function() {
						infoCont = '<p style="color:#333;"><b>taxi n&deg; ' + data.name + ' - ' + data.address+ ' &agrave; ' + data.timestamp+ '</b></p>';
						self.openInfoWindow({ 'content':  infoCont}, this);
					});
					var markerYou = self.get('markers')['you'];
					markerYou.setVisible(false);
					navigator.geolocation.getCurrentPosition(function(position, status) {
						var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude)
						self.get('map').panTo(latlng);
						var userIcon = 'visuels/business_loc_icon.png';
						self.addMarker({ id: 'you', 'position': latlng, 'bounds': true, 'icon': userIcon }).click(function() {
							self.openInfoWindow({ 'content':  '<p style="color:#09F;"><b>Vous &Ecirc;tes ici</b></p>' }, this);
						});
					}, showError,{enableHighAccuracy:true, maximumAge:0});
				}, "json");
			}, 30000); 
		}});
	});
	
	$('#follow').live('pageshow', function() {
		$('#follow_map').gmap('refresh');
	});
	////////////////////////////////////////////////////////////
	
	function searchLocationsNear(center, mapEvent) {
		//clearLocations();
		//navigator.notification.alert('In searchLocationsNear');
		$('#map').gmap('refresh');
		var myDate = new Date();
		idcourse = myDate.getTime();
		//$('#dblinks').append($('<input id="idcourse" type="hidden" value="' + idcourse + '"/>'));
		//var radius = document.getElementById('radiusSelect').value;
		company = $.localStorage.getItem('company');
		var rdvpoint = document.getElementById("addressInput").value;
		var room = document.getElementById("Accurate").value;
		operator = $.localStorage.getItem('operator');
		var hostname = document.getElementById("hostname").value;
		var howMany = document.getElementById("howMany").value;
		var typecar = document.getElementById("CarType").value;
		var cb = document.getElementById("Pay").value;
		var group = document.getElementById("group").value;
		switch (cb) {
			case '0':
				var payment = "Non";
				cb = 0;
			  break;
			case '1':
				var payment = "Oui";
				cb = 1;
			  break;
			case '2':
				var payment = "Oui (AMEX)";
				cb = 1;
			  break;
			default:
				var payment = "Non";
				cb = 0;
		}
		var coms = document.getElementById("coms").value;
		var comments1 = '<ul>' + company + '<li>Nom du client : ' + room + '</li><li>Paiement CB : ' + payment + '</li><li>Nombre de passagers : ' + howMany + '</li><li>Type de vehicule : ' + typecar + '</li>';
		if (coms != '') {
			var comments2 = '<li>' + coms + '</li></ul>';
		}
		else {
			var comments2 = '</ul>';
		}
		var comments = comments1+comments2;
		var dest = document.getElementById("DestAddress").value;
		var cell = document.getElementById("cellular").value;
		var when = document.getElementById("when").value;
		var date = document.getElementById("date").value;
		//var medic = document.getElementById("medic").value;
		if (!dontReg) {
			for(n=1;n<4;n++) {
				if(($.localStorage.getItem('regName'+n) == null) && ($.localStorage.getItem('regCell'+n) == null)) {
					var regName = $.localStorage.setItem('regName'+n, $('#Accurate').val());
					var regCell = $.localStorage.setItem('regCell'+n, cell);
					var regLast = $.localStorage.setItem('regLast', n);
					var writen = true;
					break;
				}
			}
			if(!writen) {
				var regLast = $.localStorage.getItem('regLast');
				switch (regLast) {
					case '1':
						var entry = 2;
					  break;
					case '2':
						var entry = 3;
					  break;
					case '3':
						var entry = 1;
					  break;
					default:
				}
				var regName = $.localStorage.setItem('regName'+entry, $('#Accurate').val());
				var regCell = $.localStorage.setItem('regCell'+entry, cell);
			}
		}
		var rdvlat = center.lat();
		var rdvlng = center.lng();
		url = '';
		num_req = idcourse;
		i = 0; // We need to make any numreq unique on that one !!
		//$.post("https://www.mytaxiserver.com/server/app_dcvp_xml.php", { lat: rdvlat, lng: rdvlng, type: typecar, howmany: howMany, cb: cb, group: '1', dep: '', pass: 'true'}, function(xml){
		$.post('https://www.mytaxiserver.com/server/app_dcvp_xml.php', {lat: rdvlat, lng: rdvlng, type: typecar, howmany: howMany, cb: cb, group: group, dep: '34', zip: zip, pass: 'true'}, function(xml){
			//navigator.notification.alert('IN');
			$(xml).find('marker').each(function(){
				var name = $(this).attr('name');
				var address = $(this).attr('address');
				var lat2 = $(this).attr('lat');
				var lng2 = $(this).attr('lng');
				var timestamp = $(this).attr('timestamp');
				var distance = $(this).attr('distance');
				i = $(this).attr('count');
				num_req = num_req+1;
				var latlng = new google.maps.LatLng(lat2, lng2);			
				var display_name = 'Taxi ' + name;
				var cabIcon = 'visuels/taxi_loc_icon.png';
				mapEvent.addMarker({ id: i ,'position': latlng, 'bounds': true, 'title': display_name, 'icon': cabIcon }).click(function() {
					infoCont = '<p style="color:#333;"><b>taxi n&deg; ' + name + ' est &agrave; ' + parseFloat(distance).toFixed(1) + ' Km de vous tel: ' + address+ '</b></p>';
					mapEvent.openInfoWindow({ 'content':  infoCont}, this);
				});
				//mapEvent.addBounds(latlng);
				url = 'taxi=' + name + '&tel=' + address + '&idcourse=' + idcourse + '&num_req=' + num_req + '&rdvpoint=' + rdvpoint + '&lat=' + rdvlat + '&lng=' + rdvlng + '&comments=' + comments + '&cell=' + cell + '&when=' + when + '&date=' + date + '&operator=' + operator + '&dep=34&group=1&ack=0&db=1&prix=20000';
				url = url.replace(/'/g, "&rsquo;");
				url = url.replace(/(?:\r\n|\r|\n)/g, '<br/>'); // Replaces line breaks by <br/>
				//$.post("https://www.mytaxiserver.com/server/diary_app_share.php", url, function(data) {});
				$('#dblinks').append($('<input class="cabs" id="' + i + '" type="hidden" onclick="sendJob(\''+ url +'\')" />'));
			});
			num_req = num_req+1;
			i = parseInt(i,10)+1;
			url = 'taxi=0000&tel=0000000000&idcourse=' + idcourse + '&num_req=' + num_req + '&rdvpoint=' + rdvpoint + '&lat=' + rdvlat + '&lng=' + rdvlng + '&comments=' + comments + '&cell=' + cell + '&when=' + when + '&date=' + date + '&operator=' + operator + '&dep=34&group=1&ack=0&db=1&prix=20000';
			url = url.replace(/'/g, "&rsquo;");
			url = url.replace(/(?:\r\n|\r|\n)/g, '<br/>'); // Replaces line breaks by <br/>
			// Sends Auction Request to TaxiMedia Server
			$('#dblinks').append($('<input class="cabs" id="' + i + '" type="hidden" onclick="sendJob(\''+ url +'\')" />'));
			//$.post("https://www.mytaxiserver.com/server/diary_app_share.php", url, function(data) {});
		}, "xml");
		$.mobile.loading( "hide" );
		$('#dblinks').append($('<input id="stop" type="hidden" value="0" />'));
		deliver();
	}// ENDS FUNCTION


    function deliver()
    {	
        //$("a.load").trigger('click');
        var GoOn = setTimeout( function () {
            $("#deliver").trigger('click');
        }, 2000);
    }
	
    function sendJob(url)
    {	
		$.post("https://www.mytaxiserver.com/server/diary_app_share.php", url, function(data) {});
    }
	
    function check_answer()
    {
		$.post("https://www.mytaxiserver.com/server34/status.php?idcourse=" + idcourse + "&check=1" , {}, function(data){ 
			if (data != 0)
			{
				clearInterval(time);
				clearTimeout(endcourse);
				cancel(idcourse);
				document.getElementById('stop').value = 1;
				//var box = navigator.notification.alert(data);
				//stopCall();
				//var box = navigator.notification.alert(data);
				//$('#thanksResults').empty().append(data);
				$('#answer').empty().append(data);
				$( "#answerBox" ).popup( "open", { positionTo: "window" } );
				/*
				var box = confirm(data);
				if (box == true) {
					parent.location.href='taxipad_portal.php';
				}
				else {
					parent.location.href='taxipad_portal.php';
				}
				*/
				//return false;
			}
		}).done(function(data) {
			setTimeout('check_answer()', 2000);
		});
    }
    function cancel(idcourse)
    {
		//navigator.notification.alert(idcourse);
        $.post("https://www.mytaxiserver.com/server34/diary.php?idcourse=" + idcourse + "&ack=1&db=1&cab_wont=1&del=1"); 
    }        
	function stopCall()
	{
		//$.mobile.loading( "show" );
		$('#dblinks').empty();	 
		clearInterval(time);
		clearTimeout(endcourse);
		cancel(idcourse);
		idcourse=''; // reset idcourse
		$('#map').gmap('destroy');
		$( "#backPop" ).popup( "open", { positionTo: "window" } );
		var wait2getBack = setTimeout( function () {
			//document.location.href='index.html';
			$.mobile.pageContainer.pagecontainer("change", "#infos", { transition: "slide"} );
		}, 1000);
	}
    function goback(flag)
    {
		$('#dblinks').empty();	 
		clearInterval(time);
		clearTimeout(endcourse);
		idcourse=''; // reset idcourse
		//$('#map').gmap('destroy');
		//$('#follow_map').gmap('destroy');
        document.location.href=flag;
		//$.mobile.pageContainer.pagecontainer("change", "#infos", { transition: "slide"} );
    }        
    function processMap()
    {
        $.mobile.pageContainer.pagecontainer("change", "#map_page", { transition: "slide"} );
    }
	/*
	$('#infos').live("swiperight", function() {
		$("#panel_poper").trigger('click');
	});
	*/
    </script>
    </head>
    <body style="margin:0px; padding:0px;">
    <div data-role="panel" id="homepanel" data-position="right" data-display="reveal">
        <!-- panel content goes here -->
        <ul data-role="listview" data-inset="true" data-theme="c">
          <li><a href="#infos" class="ui-btn ui-btn-icon-left ui-icon-home"><b>Accueil</b></a></li>
          <li><a href="#history" class="ui-btn ui-btn-icon-left ui-icon-bars">Historique</a></li>
          <li><a href="#account" class="ui-btn ui-btn-icon-left ui-icon-user">Mon compte</a></li>
          <li><a href="#fleet_page" class="ui-btn ui-btn-icon-left ui-icon-eye">Taxis disponibles</a></li>
          <li><a href="#" onClick="Share()" data-transition="slide" class="ui-btn ui-btn-icon-left ui-icon-mail noAppHide">Partager l&rsquo;app</a></li>
          <li><a href="#" onClick="goScan()" data-transition="slide" class="ui-btn ui-btn-icon-left ui-icon-camera noAppHide">Scanner un code</a></li>
        </ul>
        <button class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-power" onClick="dc()">D&eacute;connexion</button>
    </div><!-- /panel -->
    <div data-role="page" data-theme="c"  id="infos">
        <div data-role="header" data-position="fixed" class="header">
			<table width="100%" border="0" class="header_cont">
				<thead><tr><th width="50%"></th><th width="34%"></th><th width="16%"></th></tr></thead>
				<tbody>
				<tr><td>
					<img src="visuels/header.png" width="100%" style="max-width:512px;"/>
				</td><td>
					<p>&nbsp;</p>
				</td><td align="center">
					<a href="#homepanel" id="panel_poper" data-role="none" style="width:90%;">
						<img src="visuels/ico_menu.png" width="100%" style="max-width:175px;"/>
					</a>
				</td></tr>
				</tbody>
			</table>
		</div>
        <div class="ui-content" role="main">
            <center>
            <div style="margin-top:1em; display:block;">
                <!-- <img src="visuels/logo.png" width="60%" style="margin-bottom:-0.6em; max-width:252px"/> -->
                <input type="hidden" id="operator" size="40" value="0"/>
                <input type="hidden" id="hostname" size="40" value=""/>
                <input type="hidden" id="group" size="16" value="1"/>
                <input type="hidden" id="exclu" size="1" value="0"/>
                <input type="hidden" id="goFavs" size="1" value="0"/>
                <table width="100%" border="0">
                	<thead><tr><th width="90%"></th><th width="10%"></th></tr></thead>
                    <tbody>
                	<tr><td>
                        <input type="text" id="addressInput" data-clear-btn="true" size="40" placeholder="Adresse RDV" width="90%" style="min-height:3em;"/>
                    </td><td align="center">
						<img src="visuels/ico_geolocalisation.png" width="100%" class="cursor" onClick="locateMe()" style="max-width:40px;"/>
                        <!-- <button onClick="locateMe()" class="ui-btn ui-btn-c ui-icon-location ui-shadow-icon ui-btn-icon-notext ui-corner-all"></button> -->
                    </td></tr>
                <input type="hidden" id="DestAddress" size="10" value="DESTINATION"/>
                	<tr><td>
                        <input type="text" id="Accurate" data-clear-btn="true" class="mustHave" size="32" placeholder="Nom *" style="min-height:3em;"/>
                    </td><td align="center">
						<img src="visuels/ico_modif.png" width="100%" class="cursor" onClick="getContact()" style="max-width:45px;"/>
                        <!-- <button onClick="getContact()" class="ui-btn ui-btn-c ui-icon-edit ui-shadow-icon ui-btn-icon-notext ui-corner-all"></button> -->
                    </td></tr>
                	<tr><td>
                        <input type="tel" id="cellular" data-clear-btn="true" class="mustHave" size="20" placeholder="Tel *" style="min-height:3em;"/>
                    </td><td align="center">
                        <a href="#rememberMe" data-rel="popup" data-position-to="window">
							<img src="visuels/ico_favori.png" width="100%" class="cursor" onClick="locateMe()" style="max-width:50px;"/>
						</a>
                    </td></tr>
                    </tbody>
                </table>
                <!-- <p style="font-size:small;"><em>*</em> Ces informations sont obligatoires</p> -->
                <p class="expends"><b>D&eacute;tails</b><br><img src="visuels/dots.png" width="100%" style="max-width:1200px;"/></p>
                <div id="details">
                    <label for="howMany">Nombre de passagers :</label>
                    <input name="howMany" id="howMany" min="1" max="20" value="1" data-theme="c" data-show-value="true" data-popup-enabled="true" type="range">
                    <select id="CarType"> 
                        <option value="Berline" selected>Vehicule</option>
                        <option value="Berline">Berline</option>
                        <option value="Break">Break</option>
                        <option value="Van">Monospace</option>
                    </select>
                    <!-- 
                    <select id="medic"> 
                        <option value="0" selected>Conventionn&eacute;</option>
                        <option value="0">Non</option>
                        <option value="1">Oui</option>
                    </select>
                    -->
                    <select id="Pay"> 
                        <option value="0" selected>CB / AMEX</option>
                        <option value="0">Aucun</option>
                        <option value="1">CB</option>
                        <option value="2">AMEX</option>
                    </select>
                    <textarea id="coms" placeholder="Commentaires"></textarea>
                </div>
                <p class="expends"><b>Infos Resa</b><br><img src="visuels/dots.png" width="100%" style="max-width:1200px;"/></p>
                <div id="book">
                    <p id="datelabel"><b>Date et heure du RDV si r&eacute;servation :</b></p>
                    <span style="display:inline-block;width: 48%;">
                        <input type="date" id="date" placeholder="jj/mm/aaaa" data-inline="true" value=""/>
                    </span>
                    <span style="display:inline-block;width: 48%;">
                        <input type="time" id="when" placeholder="hh:mm" data-inline="true" value=""/>
                    </span>
                </div>
                <input type="hidden" id="radiusSelect" value="100" />
                <p>&nbsp;</p>
                <div id="next-box"><button id="next" class="ui-btn ui-btn-b ui-shadow ui-corner-all ui-btn-icon-left ui-icon-next">* Champs obligatoires</button></div>
                <div id="search-box"><button onClick="checkZip('#map_page')" class="ui-btn ui-btn-c ui-shadow ui-corner-all ui-btn-icon-left ui-icon-search" id="search">Commander un taxi</button></div>
                <div id="book-box"><button onClick="booking()" class="ui-btn ui-btn-c ui-shadow ui-corner-all ui-btn-icon-left ui-icon-clock" id="booking">R&eacute;server un taxi</button></div>
                <div data-role="popup" data-theme="a" id="errorPop" data-dismissible="true">
					<a href="#infos" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right">Fermer</a>
                    <div data-theme="a" data-role="header">
                        <h1>
                            G&eacute;olocalisation
                        </h1>
                    </div>
                    <div class="ui-content" role="main">
                        <div id="resultsGeo"></div>
                    </div>
                </div>
                <div data-role="popup" data-theme="a" id="rememberMe" data-dismissible="true">
 					<a href="#infos" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right">Fermer</a>
                   <div data-theme="a" data-role="header">
                        <p style="font-size:21px;text-align:center;"><b>
                            Enregistrements
                        </b></p>
                    </div>
                    <div class="ui-content" role="main">
                        <div id="regLinks"></div>
                    </div>
                </div>
                <div data-role="popup" data-theme="a" id="setZip" data-dismissible="true">
 					<a href="#infos" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right">Fermer</a>
                   <div data-theme="a" data-role="header">
                        <p style="font-size:21px;text-align:center;"><b>
                            CP Commune
                        </b></p>
                    </div>
                    <div class="ui-content" role="main">
                    	<p>
                            Veuillez saisir le code postal de la commune o&ugrave; vous vous trouvez :
                            <input type="tel" id="zipDep" data-clear-btn="true" size="5"/>
                        </p>
                        <button class="ui-btn ui-corner-all ui-shadow ui-btn-c ui-btn-icon-left ui-icon-check" onClick="setZip()">Envoyer</button>
                    </div>
                </div>
            </div>
            </center>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="map_page" >
        <div class="ui-content" role="main" id="map">
			<div data-role="popup" data-theme="c" id="answerBox" data-dismissible="false" data-position-to="window">
				<div data-theme="c" data-role="header">
					<h1>
						Confirmation
					</h1>
				</div>
				<div class="ui-content" role="main">
					<div id="answer"></div>
					<input type="button" value="OK" onClick="goback('index.html')"/>
				</div>
			</div>
			<div data-role="popup" data-theme="c" id="backPop" data-dismissible="false">
				<div data-theme="c" data-role="header">
					<h1>
						Annulation
					</h1>
				</div>
				<div class="ui-content" role="main">
					<p><strong>
						Vous avez annul&eacute; votre demande ou 
						aucun taxis n&rsquo;a r&eacute;pondu dans le temps imparti, vous devriez rechercher de nouveau.
					</strong></p>
				</div>
			</div>
        </div>
        <div data-role="footer" id="footer_map" data-position="fixed" data-fullscreen="true">
			<div id="deliv-hide" style="width: 0px; height: 0px; visibility:hidden;">
				<input type="button" onClick="" id="deliver" value="" />
			</div>
			<div id="left" style="width: 0px; height: 0px; visibility:hidden;">
				<div id="dblinks">
				</div>
			</div>
			<p><strong>Veuillez patienter pendant la recherche et ne pas quitter l&rsquo;app SVP
			<button type="button" class="cancel ui-btn ui-btn-b ui-shadow ui-corner-all ui-btn-icon-left ui-icon-delete" id="cancel" onClick="stopCall()" value=""> Retour / Annulation </button></strong></p>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="connect">
        <div class="ui-content" role="main">
            <center>
            <div style="margin-top:1em; display:block;">
				<img src="visuels/logo_montaxi.png" width="60%" style="max-width:512px;"/>
                <input type="tel" id="login" data-clear-btn="true" size="40" placeholder="Identifiant"/>
                <input type="password" id="pwd" data-clear-btn="true" size="40" placeholder="Mot de passe"/>
                <div id="loginReturns"></div>
                <button class="ui-btn ui-corner-all ui-shadow ui-btn-c ui-btn-icon-left ui-icon-check" onClick="login()">Connexion</button>
                <a href="#subscription" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-user">Nouvelle Inscription</a>
                <p style="font-size:small;"><a href="#" id="displayForgot">Mot de passe oubli&eacute;</a></p>
                <div id="forgotForm" style="display:none;">
                    <input type="tel" id="forgotTel" data-clear-btn="true" size="40" placeholder="Identifiant"/>
                    <input type="email" id="forgotMail" size="32" maxlength="60" placeholder="email"/>
                    <button class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-mail" onClick="forgottenPwd()">Envoyer</button>
                </div>
                <div id="fogotReturns"></div>
           </div>
            </center>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="subscription">
        <div data-role="header" data-position="fixed" class="header">
			<a href="#connect" class="ui-btn ui-btn-icon-left ui-corner-all ui-shadow ui-icon-back"><p style="font-size:16px"><b>Retour</b></p></a>
		</div>
        <div class="ui-content" role="main">
			<div class="cleaner"></div>
            <div style="padding:1em; display:block;">
            	<center>
				<img src="visuels/logo_montaxi.png" width="60%" style="max-width:512px;"/>
                <input type="text" id="subName" data-clear-btn="true" size="40" placeholder="Nom"/>
                <input type="email" id="subMail" data-clear-btn="true" size="40" placeholder="Email"/>
                <input type="tel" id="subTel" data-clear-btn="true" size="40" placeholder="Tel (Sans espace SVP)"/>
                <button class="ui-btn ui-corner-all ui-shadow ui-btn-c ui-btn-icon-left ui-icon-check" onClick="subscribe()">Inscription</button>
                </center>
                <div id="data"></div>
                <div id="subReturns"></div>
            </div>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="account">
        <div data-role="header" data-position="fixed" class="header">
			<table width="100%" border="0" class="header_cont">
				<thead><tr><th width="50%"></th><th width="34%"></th><th width="16%"></th></tr></thead>
				<tbody>
				<tr><td>
					<img src="visuels/header.png" width="100%" style="max-width:512px;"/>
				</td><td>
					<p>&nbsp;</p>
				</td><td align="center">
					<a href="#homepanel" id="panel_poper" data-role="none" style="width:90%;">
						<img src="visuels/ico_menu.png" width="100%" style="max-width:175px;"/>
					</a>
				</td></tr>
				</tbody>
			</table>
		</div>
        <div class="ui-content" role="main">
            <div style="padding:1em; display:block;">
            	<center>
                <input type="tel" id="accTel" data-clear-btn="true" size="40" placeholder="Tel (Sans espace SVP)"/>
                <input type="text" id="accName" data-clear-btn="true" size="40" placeholder="Nom"/>
                <input type="email" id="accMail" data-clear-btn="true" size="40" placeholder="Email"/>
                <input type="password" id="accPwd" data-clear-btn="true" size="40" placeholder="Mot de passe"/>
                <button class="ui-btn ui-corner-all ui-shadow ui-btn-c ui-btn-icon-left ui-icon-edit" onClick="accountMod()">Modifier</button>
                </center>
                <div id="accReturns"></div>
            </div>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="history">
        <div data-role="header" data-position="fixed" class="header">
			<table width="100%" border="0" class="header_cont">
				<thead><tr><th width="50%"></th><th width="34%"></th><th width="16%"></th></tr></thead>
				<tbody>
				<tr><td>
					<img src="visuels/header.png" width="100%" style="max-width:512px;"/>
				</td><td>
					<p>&nbsp;</p>
				</td><td align="center">
					<a href="#homepanel" id="panel_poper" data-role="none" style="width:90%;">
						<img src="visuels/ico_menu.png" width="100%" style="max-width:175px;"/>
					</a>
				</td></tr>
				</tbody>
			</table>
		</div>
        <div class="ui-content" role="main">
            <div style="display:block;">
				<button onClick="refreshHist()" class="ui-btn ui-btn-b ui-btn-right ui-icon-refresh ui-shadow-icon ui-btn-icon-notext ui-corner-all"></button>
            	<center>
                <p style="font-size:16px;color:#FC0;"><b>Historique des courses</b><br><img src="visuels/dots.png" width="100%" style="max-width:1200px;"/></p>
                </center>
				<button class="ui-btn ui-corner-all ui-shadow ui-btn-c ui-btn-icon-left ui-icon-clock ui-btn-inline" onClick="showCont('.ui-block-a','.ui-block-b')">Commandes</button>
				<button class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-calendar ui-btn-inline" onClick="showCont('.ui-block-b','.ui-block-a')">R&eacute;servations</button>
                <div class="responsive transpcont rounded shadow">
                    <div class="ui-block-a"><div class="ui-body">
						<div id="hist_cont"></div>
					</div></div>
                    <div class="ui-block-b"><div class="ui-body">
						<div id="book_cont"></div>
					</div></div>
                </div>
            </div>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="book_page">
        <div data-role="header" data-position="fixed" class="header">
			<table width="100%" border="0" class="header_cont">
				<thead><tr><th width="50%"></th><th width="34%"></th><th width="16%"></th></tr></thead>
				<tbody>
				<tr><td>
					<img src="visuels/header.png" width="100%" style="max-width:512px;"/>
				</td><td>
					<p>&nbsp;</p>
				</td><td align="center">
					<a href="#homepanel" id="panel_poper" data-role="none" style="width:90%;">
						<img src="visuels/ico_menu.png" width="100%" style="max-width:175px;"/>
					</a>
				</td></tr>
				</tbody>
			</table>
		</div>
        <div class="ui-content" role="main">
            <div class="ui-bar-b ui-corner-all ui-shadow" style="padding:1em; display:block;">
            	<center>
                <p><b><br><br>Votre demande a &eacute;t&eacute; prise en compte, votre taxi prendra contact avec vous par t&eacute;l&eacute;phone ou sms.<br><br>Toute l&rsquo;&eacute;quipe monTaxi 34 vous remercie.</b></p>
                <button class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-back" onClick="goback('index.html')">Retour</button>
                </center>
            </div>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="fleet_page" >
        <div data-role="header" data-position="fixed" data-fullscreen="true">
            <button onClick="goback('index.html')" class="ui-btn ui-btn-icon-left ui-corner-all ui-shadow ui-icon-power"><p style="font-size:16px"><b>Retour</b></p></button>
        </div>
        <div class="ui-content" id="fleet_map" role="main">
        </div>
        <div data-role="footer" id="footer_map" data-position="fixed" data-fullscreen="true">
            <center>
                <span class="cabNum" style="font-size:24px; color:#FC0;"></span>
            </center>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="follow">
        <div data-role="header" data-fullscreen="true">
            <button onClick="goback('index.html')" class="ui-btn ui-btn-icon-left ui-corner-all ui-shadow ui-icon-power"><p style="font-size:16px"><b>Arr&ecirc;ter</b></p></button>
        </div>
        <div class="ui-content" id="follow_map" role="main">
        </div>
        <div data-role="footer" id="footer_map" data-position="fixed" data-fullscreen="true">
            <center><p><strong>
            	Vous ne pouvez suivre un taxi que 30 minutes avant le RDV.<br>
                Les positions sont actualis&eacute;es toutes les 30 secondes.
            </strong></p></center>
        </div>
    </div>
    <div data-role="page" data-theme="c" id="rate_page">
        <div data-role="header" data-position="fixed" class="header">
			<table width="100%" border="0" class="header_cont">
				<thead><tr><th width="50%"></th><th width="14%"></th><th width="36%"></th></tr></thead>
				<tbody>
				<tr><td>
					<img src="visuels/header.png" width="100%" style="max-width:512px;"/>
				</td><td>
					<p>&nbsp;</p>
				</td><td align="center">
					<a href="#history" class="ui-btn ui-btn-icon-left ui-corner-all ui-shadow ui-icon-back"><p style="font-size:16px"><b>Retour</b></p></a>
				</td></tr>
				</tbody>
			</table>
		</div>
        <div class="ui-content" role="main">
            <div style="display:block;">
            	<center>
                <div id="urate" style="font-weight:bold;color: #FC0;"></div>
                </center>
                <div class="ui-bar-a ui-corner-all ui-shadow" style="padding:1em; display:block;">
                    Accueil :
                    <div class="rating" data-rating-max="5"></div><div class="cleaner"></div>
                    Tarif : 
                    <div class="rating2" data-rating-max="5"></div><div class="cleaner"></div>
                    Propret&eacute; / Vehicule : 
                    <div class="rating3" data-rating-max="5"></div><div class="cleaner"></div>
                    Conduite / itin&eacute;raire : 
                    <div class="rating4" data-rating-max="5"></div><div class="spacer"></div>
                </div>
                <center><div id="rateBack"></div></center>
                <button class="ui-btn ui-corner-all ui-shadow ui-btn-c ui-btn-icon-left ui-icon-check" onClick="rating()">Envoyer</button>
            </div>
        </div>
    </div>
	<div data-role="page" data-theme="c" id="modbook">
        <div data-role="header" data-position="fixed" class="header">
			<table width="100%" border="0" class="header_cont">
				<thead><tr><th width="50%"></th><th width="14%"></th><th width="36%"></th></tr></thead>
				<tbody>
				<tr><td>
					<img src="visuels/header.png" width="100%" style="max-width:512px;"/>
				</td><td>
					<p>&nbsp;</p>
				</td><td align="center">
					<a href="#history" class="ui-btn ui-btn-icon-left ui-corner-all ui-shadow ui-icon-back"><p style="font-size:16px"><b>Retour</b></p></a>
				</td></tr>
				</tbody>
			</table>
		</div>
        <div class="ui-content" role="main">
            <center>
            <div style="margin-top:1em; display:block;">
                <!-- <h1 class="hostname">Commander un taxi</h1> -->
                <table width="100%" border="0">
                	<thead><tr><th width="90%"></th><th width="10%"></th></tr></thead>
                    <tbody>
                	<tr><td>
                        <input type="text" id="addressInput2" data-clear-btn="true" size="40" placeholder="Adresse RDV" width="90%"/>
                    </td><td align="center">
						<img src="visuels/ico_geolocalisation.png" width="100%" class="cursor" onClick="locateMe()" style="max-width:40px;"/>
                    </td></tr>
                	<tr><td>
                        <input type="text" id="Accurate2" data-clear-btn="true" class="mustHave" size="32" placeholder="Nom *"/>
                    </td><td align="center">
						<img src="visuels/ico_modif.png" width="100%" class="cursor" onClick="getContact()" style="max-width:45px;"/>
                    </td></tr>
                	<tr><td>
                        <input type="tel" id="cellular2" data-clear-btn="true" class="mustHave" size="20" placeholder="Tel *"/>
                    </tbody>
                </table>
                <!-- <p style="font-size:small;"><em>*</em> Ces informations sont obligatoires</p> -->
                <p class="expends"><b>D&eacute;tails</b><br><img src="visuels/dots.png" width="100%" style="max-width:1200px;"/></p>
                <div id="details">
                    <label for="howMany">Nombre de passagers :</label>
                    <input name="howMany" id="howMany2" min="1" max="8" value="1" data-theme="c" data-show-value="true" data-popup-enabled="true" type="range">
                    <select id="CarType2"> 
                        <option value="Berline" selected>Vehicule</option>
                        <option value="Berline">Berline</option>
                        <option value="Break">Break</option>
                        <option value="Van">Monospace</option>
                    </select>
                    <select id="Pay2"> 
                        <option value="0" selected>CB</option>
                        <option value="0">Non</option>
                        <option value="1">Oui</option>
                    </select>
                    <textarea id="coms2" placeholder="Commentaires"></textarea>
                </div>
                <p id="datelabel"><b>Date et heure du RDV :</b></p>
                <input type="text" id="date2" placeholder="Date" data-clear-btn="true" data-inline="true" value=""/>
                <!-- 
                <span style="display:inline-block;width: 48%;">
                    <input type="date" id="date2" placeholder="Date" data-clear-btn="true" data-inline="true" value=""/>
                </span>
                <span style="display:inline-block;width: 48%;">
                    <input type="time" id="when2" placeholder="Heure" data-clear-btn="true" data-inline="true" value=""/>
                </span>
                -->
                <p>&nbsp;</p>
                <input type="hidden" id="modId" size="20" value=""/>
                <input type="hidden" id="modDep" size="2" value=""/>
				<div id="resmod"></div>
                <button onClick="bookingMod()" class="ui-btn ui-btn-c ui-shadow ui-corner-all ui-btn-icon-left ui-icon-clock" id="bookingMod">Modifier la r&eacute;servation</button>
            </div>
            </center>
        </div>
    </div>
	</body>
</html>